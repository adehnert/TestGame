\documentclass[green]{testgame}
\def\gamename{Gamewriting}
\def\gamedate{Whenever}

\begin{document}

% I wanted to use fancyvrb for this, but it doesn't seem to work in (at least)
% GameTeX compendia.
\newcommand{\ter}[1]{\fbox{\parbox{6.5in}{{\tt #1}}}}

\name{Crash Intro to Git}

This is a short document on how to use the Git version control
system.\footnote{last modified October 16, 2016; based on ``Crash Intro to SVN''} It will teach you the
bare minimum you need to know to use it with game development.

\paragraph*{What is Git?}

Git is a ``version control system'': basically,
it tries to solve all of the things that can go wrong when multiple
people are editing, adding and deleting files from a big directory all
at once (two people trying to edit the same file, nobody knowing who
has the newest version of a given file, etc.). This is what you will
be doing while writing a game.

Although Git is a ``distributed VCS'', you will most likely want to use it in a centralized fashion, as follows:


\begin{itemz}[]

\item You will maintain one central repository with the latest version of your sheets. Most likely, this will be on \href{https://github.com}{Github} (a hosting service), but it could also be on \href{https://bitbucket.org/}{BitBucket} (another hosting service) or in an Athena locker.

\item Each user will have their own ``clone'' of the repository, which will also have all the sheets. You will write the game by modifying this local copy and ``pushing'' those changes back to the repository.

\item When a user asks for the most up-to-date version of the project, Git will give it to them, being careful not to overwrite changes that they've made on their copy.

\end{itemz}

We will talk about how to set it up and how to use it. First, make sure you have it installed: run \texttt{git --version} at a command prompt. On an Athena machine, or any other machine with git installed, this should return \texttt{git version \textit{...}}. If you don't have git installed and are running Debian or Ubuntu, install it with \texttt{apt-get install git}. On other systems, see \TODO{install instructions} for advice.

\section{Creating and populating a git repository}

{\em You will only have to do this step once per game.}

\subsection{Choosing a repo host}

You have several options for where to host your repository, with different advantages and disadvantages for each. You will most likely want a host that supports ``private'' repositories (ones only viewable by your GM team), so that your players don't accidentally spoil themselves.

\paragraph*{Github} Github is probably the biggest commercial Git host, and provides free public repositories to everyone. Unfortunately, private repositories generally require paying money, but if one of your GMs is a \emph{student}, they can get free private repositories through the \TODO{name of student pack}. If one of your GMs already pays Github for private repos, they can also create another one for free.

Github comes with a nice web interface, web-based collaboration tools (of somewhat dubious value for game-writing), and can be integrated with CircleCI\footnote{CircleCI is a ``continuous integration'' tool, which can help you discover mistakes you made in your \gametex{} before another GM runs into it. However, if nobody on your team is confident with the terminal and git, it's probably more complicated than its worth. See ``\gCI{}'' for details. \TODO{link to CircleCI docs}}.

If you choose to use Github, the GM with private repos available should go to \url{https://github.com/new}, name the repo after your game, mark it as private, and not create a README. After the repo has been created, go to Settings->Collaborators and add all your co-GMs to the list of collaborators.

\paragraph*{Bitbucket} Bitbucket is another large commercial Git host, which provides free public repos and \href{https://bitbucket.org/product/pricing/}{free private repos with up to five collaborators each}. Bitbucket has many of the same features as Github, including CircleCI support, but it's less widely used.

\paragraph*{\href{https://github.mit.edu}{github.mit.edu}} Github also has an ``enterprise'' version that MIT has purchased. This has much the same web interface as the normal Github, has unlimited free private repos, and uses Touchstone for authentication (which is convenient for people with Athena account and usable for those without), but doesn't support CircleCI. If you choose to use github.mit.edu, any GM can go to \url{https://github.mit.edu/new}, after which the procedure should be similar to the normal Github procedure.

\paragraph*{Athena} You can also host your git repo out of a GM's Athena locker. This loses the web interface of the other systems and requires an Athena account for any collaborators.

You will need an MIT mailing list for your team -- create one at \TODO{list creation}.  It should be a moira list (\emph{not} mailman) and an AFS group.

One of you should agree to host it in your locker, say in a directory called \texttt{gitgamename}. From the command line, you should do several things.

First, create the directory and give your GM team access to it (let's
say that your GMs are all on a list called \texttt{gamename-gms}. Then,
remove everybody else's ``list'' permissions from it. We'll call the
user creating the repo \texttt{joeuser}.

\ter{\$ mkdir gitgamename\\
\$ fs sa gitgamename system:gamename-gms write\\
\$ fs sa gitgamename system:anyuser none}

You can double check the permissions. They should look something like
this:

\ter{\$ fs la gitgamename\\
Access list for gitgamename is\\
Normal rights:\\
  system:gamename-gms rlidwk\\
  system:expunge ld\\
  joeuser rlidwka}

Then, let's create a fresh, blank repository inside:

\ter{\$ git init --bare gitgamename.git}

If you look inside the repo, it will have all sorts of mysterious directories.

\ter{\$ ls gitgamename.git/\\
branches/  config  description  HEAD  hooks/  info/  objects/  refs/}

\textbf{Do not manually change anything inside the repository}, unless you know how to use git (or are following directions from somebody who does). It will look like garbage anyway. Only use the Git commands we'll talk about in a second.

\subsection{Add \gametex{} to a repo}

\paragraph*{Cloning a copy}

\emph{You will only have to do this step once per GM.}

Each GM needs to clone a local copy of the game's repo.

Decide where your local copy will sit (if using Athena, you probably
want it somewhere like\\ {\tt /mit/yourusername/Private/GameName/},
but consult the ``Intro to GameTeX'' greensheet). Make sure any parent directories exist, change into the parent directory, and then clone the repository:

\ter{%
\% mkdir -p /mit/yourusername/Private/\\
\% cd /mit/yourusername/Private/\\
\% git clone \emph{path-to-repo} GameName/\\
Cloning into 'GameName'...
warning: You appear to have cloned an empty repository.
done.
}

(The warning message will appear until one GM does the next step, ``Initializing the repo''. However, it's harmless, and it's fine for all the GMs to do this step before any does the next one.)

Above, make sure to replace \texttt{\emph{path-to-repo}} up above with
the actual location of the repository (something like
\texttt{ssh://git@github.com/joeuser/GameName} for Github or
\texttt{/mit/joeuser/Private/gitgamename/gitgamename.git} for Athena).
After all is said and done, you will now have a working local copy of
the repository. Each GM should do this, including the one who created
the repository. Your checked out copy will have a hidden
\texttt{.git/} folders all over the place that you may notice. Don't
mess with those -- that's just how Git keeps track of some
information.

\paragraph*{Initializing the repo} \emph{You will only need to do this step once per game.}

One (and only one) GM will need to add GameTeX to the repository. Before starting this, you should already have the git repository cloned (from the above step), but it should still be empty.

%Before you do this step, you should have a GameTeX tree already set up
%in one of your lockers (see the ``Crash Intro to GameTeX'' greensheet;
%life will be easier if you've already run Extras/changeclass.pl).

This blank repository needs a copy of your GameTeX tree in it so that
you can start using the repo. To do this, you need to \emph{import} the
tree so that the repo can start keeping track of it. Go to the root of
a GameTeX tree you've previously set up, and run the following
commands. A text editor will pop up. Just enter ``Initial commit'' and
exit the text editor.

\ter{%
\$ git add .\\
\$ git commit\\
\$ git push\\
Counting objects: 98, done.\\
Delta compression using up to 4 threads.\\
Compressing objects: 100\% (97/97), done.\\
Writing objects: 100\% (98/98), 173.93 KiB | 0 bytes/s, done.\\
Total 98 (delta 14), reused 0 (delta 0)\\
To \emph{path-to-repo}\\
 * {[}new branch{]}      master -> master\\
}

Now your repo contains a copy of your GameTeX tree and is ready to be
used.

\section{Normal git operations}

\paragraph*{Examining changes}

To see what changes you've made, you can run \texttt{git status} (to see a summary of changed files) and \texttt{git diff} (to see specific changes).

For example, as I write this, \texttt{git status} tells me I have one modified file (this one -- \texttt{guildcamp-git.tex}) and two untracked files (my editor, \texttt{vim}'s, tempfiles):
\begin{verbatim}
$ git status
On branch master
Your branch is ahead of 'origin/master' by 1 commit.
  (use "git push" to publish your local commits)
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   ../Greensheets/guildcamp-git.tex

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        ../Greensheets/.guildcamp-git.tex.swp
        ../Lists/.green-LIST.tex.swp

no changes added to commit (use "git add" and/or "git commit -a")
\end{verbatim}

Running \texttt{git diff} tells me exactly what changes I've made to \texttt{guildcamp-git.tex}:
\begin{verbatim}
$ git diff
diff --git a/Greensheets/guildcamp-git.tex b/Greensheets/guildcamp-git.tex
index 8553d3c..c7ecd74 100644
--- a/Greensheets/guildcamp-git.tex
+++ b/Greensheets/guildcamp-git.tex
@@ -157,6 +157,12 @@ used.

 \section{Normal git operations}

+\paragraph*{Examining changes}
+
+To see what changes you've made, you can run \texttt{git status} [...]
+
+
+
 \paragraph*{Committing and pushing changes}
\end{verbatim}

\paragraph*{Committing and pushing changes}


\ter{%
- update
- new files
- commit / push
- merge
- additional resources
}


\end{document}
